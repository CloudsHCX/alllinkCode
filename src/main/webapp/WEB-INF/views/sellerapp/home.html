<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>万众艺兴---商家版</title>
    <link rel="stylesheet" href="../../css/sellerapp/bootstrap.css"/>
    <link rel="stylesheet" href="../../css/sellerapp/homepage.css"/>
    <link rel="stylesheet" href="../../css/sellerapp/homepage-photo.css">
    <script type="text/javascript" src="../../js/sellerapp/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/sellerapp/bootstrap.js"></script>
    <script type="text/javascript" src="../../js/userapp/ajaxfileupload.js"></script>
    <script type="text/javascript" src="../../js/sellerapp/homepage.js"></script>
    <style>
        .col-sm-offset-2 {
            margin-left: 18.666667%;
        }

        #phone-p {
            position: absolute;
            width: 265px;
            height: 40px;
            right: -278px;
            top: 1px;
            line-height: 40px;
        }
    </style>
</head>
<body>
<div class="header">
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="home.html">万众艺兴</a>
            </div>
            <div>
                <ul class="nav navbar-nav">
                    <li><a href="NewOrder.html">订单</a></li>
                    <li><a href="#">评价管理</a></li>
                    <li><a href="#">行业排名</a></li>
                    <li><a href="#">项目管理</a></li>
                    <li><a href="#">财务管理</a></li>
                    <li><a href="#">用户管理</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <span id="navName">${Session.seller.sellerName}</span><b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="home.html">个人中心</a></li>
                            <li><a href="#">法人信息</a></li>
                            <li><a href="#">安全设置</a></li>
                            <li class="divider"></li>
                            <li><a href="login.html">退出登录</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

<div class="content">
    <div class="left">
        <ul>
            <li class="big-li">
                <h2>
                    <i><img src="../../img/sellerapp/person.png"></i>
                    个人中心
                </h2>
            </li>

            <li class="big-li">
                <h2>
                    <i><img src="../../img/sellerapp/page.png"> </i>
                    我的活动
                </h2>
                <ul class="small-ul">
                    <li><a onclick="window.location.href='/alllink/views/sellerapp/EventsList.html'">所有活动</a></li>
                    <li><a onclick="window.location.href='/alllink/views/sellerapp/AddActivity.html'">添加活动</a></li>
                </ul>
            </li>

            <li class="big-li">
                <h2>
                    <i><img src="../../img/sellerapp/money.png"> </i>
                    我的资产
                </h2>
                <ul class="small-ul">
                    <li><a>账户余额</a></li>
                    <li><a>我的钱包</a></li>
                </ul>
            </li>

            <li class="big-li">
                <h2>
                    <i><img src="../../img/sellerapp/my.png"> </i>
                    我的资料
                </h2>
                <ul class="small-ul">
                    <li><a href="home.html">个人资料</a></li>
                    <li><a onclick="business()">商家认证</a></li>
                    <li><a onclick="window.location.href='/alllink/views/sellerapp/ChangePassword.html'">修改密码</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="right" id="right1">
        <h3 class="person">个人资料</h3>
        <div class="persons">
            <p>
                <span class="profileinfo-label" style="vertical-align: top;">头像</span>
                <span>
                    <span class="profileinfo-value">
                        <div id="click1"><img src="${Session.seller.photo}" id="sellerPhoto"></div>
                    </span>
                    <a class="fileinput-button1">[上传头像]<input type="file" name="file" id="photo1"></a>
  				</span>
            </p>

            <p>
                <span class="profileinfo-label">手机号</span>
                <span>
  					<span class="profileinfo-value" id="phoneNumber1">${Session.seller.phoneNumber}</span>
                    <a onclick="updateMobile()">[修改]</a>
  					</span>
            </p>
            <p>
                <span class="profileinfo-label">支付宝</span>
                <span>
  							<span class="profileinfo-value" id="alipayNumber1">${Session.seller.alipayNumber}</span>

  						</span>
            </p>
            <p>
                <span class="profileinfo-label">用户名</span>
                <span>
						 <span class="profileinfo-value" id="sellerName1">${Session.seller.sellerName}</span>
                         <span id="sellerId-none" style="display: none">${Session.seller.sellerId}</span>
						 <a onclick="updateName()">[修改]</a>
					 </span>
            </p>

            <p>
                <span class="profileinfo-label">微信号</span>
                <span>
  							<span class="profileinfo-value" id="weChatNumber1">${Session.seller.wechatNumber}</span>
  							<a onclick="updateWeChat()">[修改]</a>
  						</span>
            </p>

            <p>
                <span class="profileinfo-label">邮箱</span>
                <span>
  							<span class="profileinfo-value" id="email1">${Session.seller.email}</span>
  							<a onclick="updateEmail()">[修改]</a>
  						</span>
            </p>

            <p>
                <span class="profileinfo-label">地址</span>
                <span>
  							<span class="profileinfo-value" id="address1">${Session.seller.address}</span>
  							<a onclick="updateAddress()">[修改]</a>
					   </span>
            </p>
        </div>
    </div>


    <div class="right" id="right1.2" style="display: none;">
        <h3 class="person">修改用户名</h3>
        <div class="persons" style="width:230px;margin-left: 155px;">
            <div class="form-group">
                <input type="text" name="sellerName" class="form-control" id="sellerName2" placeholder="请输入新的用户名"
                       style="height: 45px;">
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" class="btn btn-primary btn-lg" id="name-btn"
                            style="margin-left: -56px;width: 95px;">确定
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="right" id="right1.11" style="display: none;">
        <h3 class="person">修改手机号</h3>
        <div class="persons" style="width:230px;margin-left: 155px;">
            <div class="form-group">
                <input type="text" name="phoneNumber" class="form-control" id="phoneNumber" placeholder="请输入新的手机号"
                       style="height: 45px;" onkeyup="vailPhone()">
                <p id="phone-p"></p>
            </div>
            <div class="form-group">
                <input type="button" class="btn btn-default" style="margin-left: 0;width: 95px;" value="获取验证码" id="vbtn"
                       onclick="vailPhone()">
            </div>
            <div class="form-group">
                <input type="text" name="verificationCode" class="form-control" id="verificationCode"
                       placeholder="请输入验证码" style="height: 45px;">
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" class="btn btn-primary btn-lg" id="mobile-btn"
                            style="margin-left: -56px;width: 95px;">确定
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="right" id="right1.3" style="display: none;">
        <h3 class="person">修改微信号</h3>
        <div class="persons" style="width:230px;margin-left: 155px;">
            <div class="form-group">
                <input type="text" name="weChatNumber" class="form-control" id="weChatNumber2" placeholder="请输入新的微信号"
                       style="height: 45px;">
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" class="btn btn-primary btn-lg" id="wechat-btn"
                            style="margin-left: -56px;width: 95px;">确定
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="right" id="right1.4" style="display: none;">
        <h3 class="person">修改邮箱</h3>
        <div class="persons" style="width:230px;margin-left: 155px;">
            <div class="form-group">
                <input type="text" name="email" class="form-control" id="email2" placeholder="请输入新的邮箱"
                       style="height: 45px;">
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" class="btn btn-primary btn-lg" id="email-btn"
                            style="margin-left: -56px;width: 95px;">确定
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="right" id="right1.5" style="display: none;">
        <h3 class="person">修改地址</h3>
        <div class="persons" style="width:230px;margin-left: 155px;">
            <div class="form-group">
                <input type="text" name="address" class="form-control" id="address2" placeholder="请输入新的地址"
                       style="height: 45px;">
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" class="btn btn-primary btn-lg" id="address-btn"
                            style="margin-left: -56px;width: 95px;">确定
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer"></div>


<script>
    $(function () {
        $("#mobile-btn").click(function () {
            var phoneNumber = $("#phoneNumber").val();
            var verificationCode = $("#verificatonCode").val();
            var sellerId = $("#sellerId-none").html();
            var jsondata = {"phoneNumber": phoneNumber, "sellerId": sellerId, "verificationCode": verificationCode};
            $.ajax({
                type: "POST",
                url: "/alllink/seller/update",
                processData: false,
                contentType: "application/json;charset=utf-8", //这个是发送信息至服务器时内容编码类型
                dataType: "json",
                data: JSON.stringify(jsondata),//这里必须将对象转成string类型。
                success: function (result) {
                    if (result.code == 1) {
                        var d1 = document.getElementById('right1.11');
                        var d2 = document.getElementById('right1');
                        d1.style.display = "none";
                        d2.style.display = "block";
                        $("#d1").replaceWith($("#d2").html());
                        $("#phoneNumber1").val("");
                        $("#phoneNumber1").html(result.seller.phoneNumber);
                    }
                    else {
                        alert("出现错误！请重试！");
                    }
                }
            });
        });
        //发送短信
        $("#vbtn").click(function () {
            var phoneNumber = $("#phoneNumber").val();
            var jsondata = {"phoneNumber": phoneNumber};
            $.ajax({
                type: "POST",
                url: "/alllink/seller/sendMessage",
                processData: false,
                contentType: "application/json;charset=utf-8", //这个是发送信息至服务器时内容编码类型
                dataType: "json",
                data: JSON.stringify(jsondata),//这里必须将对象转成string类型，否则将掉入无线的大坑中。
                success: function (success) {
                    if (success.code == 1) {
                        // alert("发送验证码成功");
                        var countdown = 60;

                        function sendemail() {
                            var obj = $("#vbtn");
                            settime(obj);
                        }

                        sendemail();

                        function settime(obj) { //发送验证码倒计时
                            if (countdown == 0) {
                                obj.attr('disabled', false);
                                //obj.removeattr("disabled");
                                obj.val("获取验证码");
                                countdown = 60;
                                return;
                            } else {
                                obj.attr('disabled', true);
                                obj.val("重新发送(" + countdown + ")");
                                countdown--;
                            }
                            setTimeout(function () {
                                    settime(obj)
                                }
                                , 1000)
                        }
                    } else {
                        alert(success.msg);
                    }
                }
            });
        });
    });

    //验证手机号
    function vailPhone() {
        var phone = jQuery("#phone").val();
        var flag = false;
        var message = "";
        var myreg = /^(((13[0-9]{1})|(14[0-9]{1})|(17[0]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (phone == '') {
            message = "手机号码不能为空！";
        } else if (!(/^1[34578]\d{9}$/.test(phone))) {
            message = "手机号码有误！";
        }
        else if (checkPhoneIsExist()) {
            message = "该手机号码已经被绑定！";
        } else {
            message = "该手机号码可以更换！";
            flag = true;
        }
        if (!flag) {
            //提示错误效果
            document.getElementById("phone-p").innerHTML = message;
            $("#phone-p").css("color", "#ff0000");
        } else {
            //提示正确效果
            document.getElementById("phone-p").innerHTML = message;
            $("#phone-p").css("color", "#009900");
        }
        return flag;
    }

    //验证手机号是否存在
    function checkPhoneIsExist() {
        var phone = jQuery("#phone").val();
        var flag = false;
        var status = 1;
        jQuery.ajax({
            url: "/alllink/seller/checkPhone?t=" + (new Date()).getTime(),
            data: {phoneNumber: phone},
            dataType: "json",
            type: "POST",
            async: false,
            success: function (data) {
                status = data.code;
                if (status == "0") {//手机号重复
                    flag = true;
                }
            }
        });
        return flag;
    }

    function business() {
        var sellerId = $("#sellerId-none").html();
        var jsondata = {"sellerId": sellerId};
        $.ajax({
            async: false,
            type: "POST",
            url: "/alllink/sellerauthinfo/info",
            processData: false,
            contentType: "application/json;charset=utf-8", //这个是发送信息至服务器时内容编码类型
            dataType: "json",
            data: JSON.stringify(jsondata),//这里必须将对象转成string类型。
            success: function (result) {
                if (result.code == 1) {
                    window.location.href = "/alllink/views/sellerapp/BusinessCf.html";
                } else {
                    window.location.href = "/alllink/views/sellerapp/BusinessCertification.html";
                }
            },
            error: function (XMLHttpRequest, textStatus) {
                alert("XMLHttpRequest.status:" + XMLHttpRequest.status + "|XMLHttpRequest.readyState:" + XMLHttpRequest.readyState + "|textStatus:" + textStatus);
            }
        });
    }

    document.getElementById('photo1').addEventListener('change', function (e) {
        var files = this.files;
        var img = new Image();
        var reader = new FileReader();
        reader.readAsDataURL(files[0]);
        reader.onload = function (e) {
            var mb = (e.total / 1024) / 1024;
            if (mb >= 2) {
                alert('文件大小大于2M');
                return;
            }
            img.src = this.result;
            document.getElementById('click1').innerHTML = '';
            document.getElementById('click1').appendChild(img);
        };
        var sellerId = $("#sellerId-none").html();
        var jsondata = {"sellerId": sellerId};
        $.ajaxFileUpload({
            url: "/alllink/file/image", //后台方法的路径
            type: "post",   //当要提交自定义参数时，这个参数要设置成post
            fileElementId: "photo1",    //需要上传的文件域的ID，即<input type="file">的ID。
            dataType: "json",   //服务器返回的数据类型。可以为xml,script,json,html。如果不填写，jQuery会自动判断。
            //secureuri: false,   //是否启用安全提交，默认为false。
            contentType: "application/json;charset=utf-8",
            data: jsondata,
            async: false,   //是否是异步
            success: function (result) {//提交成功后自动执行的处理函数，参数data就是服务器返回的数据。

                $("#activityPhoto").attr("src", result.url);
            },
            error: function (data, status, e) {  //提交失败自动执行的处理函数。
                alert("error");
            }
        });

    });

    function updateName() {
        var d1 = document.getElementById('right1');
        var d2 = document.getElementById('right1.2');
        d2.style.display = "block";
        $("#d1").replaceWith($("#d2").html());
    }

    function updateMobile() {
        var d1 = document.getElementById('right1');
        var d2 = document.getElementById('right1.11');
        d2.style.display = "block";
        $("#d1").replaceWith($("#d2").html());
    }

    function updateWeChat() {
        var d1 = document.getElementById('right1');
        var d2 = document.getElementById('right1.3');
        d2.style.display = "block";
        $("#d1").replaceWith($("#d2").html());
    }

    function updateEmail() {
        var d1 = document.getElementById('right1');
        var d2 = document.getElementById('right1.4');
        d2.style.display = "block";
        $("#d1").replaceWith($("#d2").html());
    }

    function updateAddress() {
        var d1 = document.getElementById('right1');
        var d2 = document.getElementById('right1.5');
        d2.style.display = "block";
        $("#d1").replaceWith($("#d2").html());
    }

</script>
</body>
</html>